'use strict';

angular.module('fsaApp')
  .controller('TeacherAddAssignmentCtrl', function ($scope, $location, toastr, $http, classroomHelper) {
    $scope.allTags = [];
    $scope.subjects = [];
    $scope.newAssignment = {
      name: '',
      subject: {},
      topic: "",
      questionNumber: 10
    };
    $http.get('api/settings/byName/subjects')
      .success(function(data) {
        $scope.subjects = data.info.subjects;
        $scope.newAssignment.subject = $scope.subjects[0]
      }).error(function(err) {
        toastr.error(err, {
          timeOut: 1000
        });
      });

    $http.get('api/questions/tags')
      .success(function(tags) {
        $scope.topics = tags;
      }).error(function(err){
        toastr.error(err, {
          timeOut: 1000
        });
      });

    $scope.updateTags = function(subject) {
      $http.get('api/questions/tags/' + subject.dbName)
        .success(function(tags) {
          $scope.topics = tags;
        }).error(function(err){
          toastr.error(err, {
            timeOut: 1000
          });
        });
    };

    $scope.addAssignment = function(assignment) {
      console.log("here is the assignment that is being created");
      console.log(assignment);
      $scope.closeThisDialog(false);
      $http.post('/api/assignments/fromTeacher', assignment)
        .success(function(assignmentFromServer){
          console.log(assignmentFromServer);
          classroomHelper.setNewAssignment(assignment);
          // should change this to be assignment code, same as short code generated by DB to allow saving
          $location.path('/teacher/assignment/' + assignmentFromServer.code);
        }).error(function(e){
          toastr.error(e, {timeOut: 1000});
        });
    };
  });